<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://sites.uab.edu/periop-datascience/streamlit/CV_Promoter_app/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Application - CV Promoter Tool</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Application";
        var mkdocs_page_input_path = "streamlit/CV_Promoter_app.md";
        var mkdocs_page_url = "/periop-datascience/streamlit/CV_Promoter_app/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> CV Promoter Tool
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">User Interface</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Application</a>
    <ul class="current">
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Backend</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../CV_Promoter/workflows/">workflows</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../CV_Promoter/cv_parsing/">parser</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">CV Promoter Tool</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">User Interface</li>
      <li class="breadcrumb-item active">Application</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/UABPeriopAI/CV_Promoter/edit/master/docs/streamlit/CV_Promoter_app.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <div class="doc doc-object doc-module">



<a id="streamlit.CV_Promoter_app"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="streamlit.CV_Promoter_app.show_CV_Promoter_page" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">show_CV_Promoter_page</span><span class="p">(</span><span class="n">template_location</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">TEMPLATE</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>The <code>show_CV_Promoter_page</code> function in Python creates a Streamlit page for users to upload a
Curriculum Vitae in Word format and generate drafts for Promotion Portfolio, Annual Review, and
Recommendation Letter based on the uploaded CV.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>template_location</code></b>
              â€“
              <div class="doc-md-description">
                <p>The <code>template_location</code> parameter in the <code>show_CV_Promoter_page</code> function is</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>used to specify the location of the template file that will be used for generating the output
documents (e.g., draft narrative, recommendation letter). This parameter allows you to customize the
template used for creating these documents</p>

            <details class="quote">
              <summary>Source code in <code>streamlit/CV_Promoter_app.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">show_CV_Promoter_page</span><span class="p">(</span><span class="n">template_location</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">TEMPLATE</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The `show_CV_Promoter_page` function in Python creates a Streamlit page for users to upload a</span>
<span class="sd">    Curriculum Vitae in Word format and generate drafts for Promotion Portfolio, Annual Review, and</span>
<span class="sd">    Recommendation Letter based on the uploaded CV.</span>

<span class="sd">    Args:</span>
<span class="sd">      template_location: The `template_location` parameter in the `show_CV_Promoter_page` function is</span>
<span class="sd">    used to specify the location of the template file that will be used for generating the output</span>
<span class="sd">    documents (e.g., draft narrative, recommendation letter). This parameter allows you to customize the</span>
<span class="sd">    template used for creating these documents</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># page metadata</span>
    <span class="n">st</span><span class="o">.</span><span class="n">set_page_config</span><span class="p">(</span><span class="n">page_title</span><span class="o">=</span><span class="s2">&quot;CV Promoter&quot;</span><span class="p">,</span> <span class="n">page_icon</span><span class="o">=</span><span class="s2">&quot;ðŸŽ“&quot;</span><span class="p">)</span>
    <span class="c1"># hide streamlit branding</span>
    <span class="n">hide_streamlit_branding</span><span class="p">()</span>

    <span class="c1"># page content</span>
    <span class="n">st</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;ðŸŽ“ Promotion and Review ðŸ’¼&quot;</span><span class="p">)</span>
    <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    **Get help with promotion and tenure (P&amp;T) or annual review materials.**</span>

<span class="sd">    Brought to you by the Anesthesiology Research, Informatics, and Perioperative Data Science teams in collaboration with Radiology Imaging Informatics, Clinicians, and Researchers.</span>

<span class="sd">    ---</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Allow user to upload a Word cv</span>
    <span class="n">uploaded_file</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">file_uploader</span><span class="p">(</span><span class="s2">&quot;Choose a Curriculum Vitae in Microsoft Word format&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;docx&quot;</span><span class="p">)</span>

    <span class="n">tab1</span><span class="p">,</span> <span class="n">tab2</span><span class="p">,</span> <span class="n">tab3</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">tabs</span><span class="p">([</span><span class="s2">&quot;Promotion Portfolio&quot;</span><span class="p">,</span> <span class="s2">&quot;Annual Review&quot;</span><span class="p">,</span> <span class="s2">&quot;Recommendation Letter&quot;</span><span class="p">])</span>

    <span class="k">with</span> <span class="n">tab2</span><span class="p">:</span>
        <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Assistant for preparing Annual Review forms.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">uploaded_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cv_document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">uploaded_file</span><span class="p">)</span>
            <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CV uploaded successfully!&quot;</span><span class="p">)</span>
            <span class="c1"># Create a dropdown for the user to select a section of interest</span>
            <span class="n">section_of_interest</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span><span class="s2">&quot;Select a section of interest:&quot;</span><span class="p">,</span> <span class="n">sections_of_interest</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s2">&quot;Extract&quot;</span><span class="p">):</span>
                <span class="c1"># submit prompt</span>
                <span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">spinner</span><span class="p">(</span><span class="s2">&quot;Extracting. This may take a while...&quot;</span><span class="p">):</span>
                    <span class="k">with</span> <span class="n">get_openai_callback</span><span class="p">()</span> <span class="k">as</span> <span class="n">response_meta</span><span class="p">:</span>
                        <span class="n">submit_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                        <span class="n">workflow</span> <span class="o">=</span> <span class="n">AnnualReviewDrafter</span><span class="p">(</span><span class="n">section_of_interest</span><span class="p">,</span> <span class="n">cv_document</span><span class="p">)</span>
                        <span class="n">generated_response</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>
                        <span class="n">response_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                        <span class="n">form_docx_data</span> <span class="o">=</span> <span class="n">convert_markdown_docx</span><span class="p">(</span><span class="n">generated_response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">template_location</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">form_docx_data</span><span class="p">:</span>
                    <span class="n">st</span><span class="o">.</span><span class="n">balloons</span><span class="p">()</span>
                    <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Note that once you hit download, this form will reset.&quot;</span><span class="p">)</span>

                    <span class="n">st</span><span class="o">.</span><span class="n">download_button</span><span class="p">(</span>
                        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Download form draft&quot;</span><span class="p">,</span>
                        <span class="n">data</span><span class="o">=</span><span class="n">form_docx_data</span><span class="p">,</span>
                        <span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;DRAFT_filled_form.docx&quot;</span><span class="p">,</span>
                        <span class="n">mime</span><span class="o">=</span><span class="s2">&quot;application/vnd.openxmlformats-officedocument.wordprocessingml.document&quot;</span><span class="p">,</span>  <span class="c1"># correct MIME type for docx</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Please upload a Word Document (.docx) CV to proceed.&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">tab1</span><span class="p">:</span>
        <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Get a draft of a narrative section of your Promotion and Tenure portfolio.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">uploaded_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cv_document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">uploaded_file</span><span class="p">)</span>
            <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CV uploaded successfully!&quot;</span><span class="p">)</span>
            <span class="c1"># Create a dropdown for the user to select a section of interest</span>
            <span class="n">section_of_interest</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span><span class="s2">&quot;Select a section of interest:&quot;</span><span class="p">,</span> <span class="n">portfolio_sections</span><span class="p">)</span>

            <span class="n">selected_date</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">date_input</span><span class="p">(</span>
                <span class="s2">&quot;What was your start date?&quot;</span><span class="p">,</span>
                <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=-</span><span class="mi">260</span><span class="p">),</span>
                <span class="n">min_value</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=-</span><span class="mi">2600</span><span class="p">),</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">selected_date</span><span class="p">:</span>
                <span class="n">start_year</span> <span class="o">=</span> <span class="n">selected_date</span><span class="o">.</span><span class="n">year</span>

            <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s2">&quot;Draft narrative&quot;</span><span class="p">):</span>
                <span class="c1"># submit prompt</span>
                <span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">spinner</span><span class="p">(</span><span class="s2">&quot;Drafting. This may take a while...&quot;</span><span class="p">):</span>
                    <span class="k">with</span> <span class="n">get_openai_callback</span><span class="p">()</span> <span class="k">as</span> <span class="n">response_meta</span><span class="p">:</span>
                        <span class="n">submit_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                        <span class="n">workflow</span> <span class="o">=</span> <span class="n">NarrativePortfolioDrafter</span><span class="p">(</span><span class="n">section_of_interest</span><span class="p">,</span> <span class="n">selected_date</span><span class="p">,</span> <span class="n">cv_document</span><span class="p">)</span>
                        <span class="n">generated_response</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>
                        <span class="n">response_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                        <span class="n">portfolio_docx_data</span> <span class="o">=</span> <span class="n">convert_markdown_docx</span><span class="p">(</span>
                            <span class="n">generated_response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">template_location</span>
                        <span class="p">)</span>

                <span class="k">if</span> <span class="n">portfolio_docx_data</span><span class="p">:</span>
                    <span class="n">st</span><span class="o">.</span><span class="n">balloons</span><span class="p">()</span>
                    <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Note that once you hit download, this form will reset.&quot;</span><span class="p">)</span>

                    <span class="n">st</span><span class="o">.</span><span class="n">download_button</span><span class="p">(</span>
                        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Download narrative draft&quot;</span><span class="p">,</span>
                        <span class="n">data</span><span class="o">=</span><span class="n">portfolio_docx_data</span><span class="p">,</span>
                        <span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;DRAFT_portfolio_section.docx&quot;</span><span class="p">,</span>
                        <span class="n">mime</span><span class="o">=</span><span class="s2">&quot;application/vnd.openxmlformats-officedocument.wordprocessingml.document&quot;</span><span class="p">,</span>  <span class="c1"># correct MIME type for docx</span>
                    <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Please upload a Word Document (.docx) CV to proceed.&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">tab3</span><span class="p">:</span>
        <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Get a draft recommendation letter for a colleague.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">uploaded_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cv_document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">uploaded_file</span><span class="p">)</span>
            <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CV uploaded successfully!&quot;</span><span class="p">)</span>
            <span class="c1"># Create a dropdown for the user to select a section of interest</span>
            <span class="n">areas_of_excellence</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">multiselect</span><span class="p">(</span>
                <span class="s2">&quot;Select one or two areas of excellence. Primary focus will be on the first one selected.&quot;</span><span class="p">,</span>
                <span class="n">portfolio_sections</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Ensure that the user selects at most two sections</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">areas_of_excellence</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">st</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Please select at most two areas.&quot;</span><span class="p">)</span>

            <span class="n">selected_date</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">date_input</span><span class="p">(</span>
                <span class="s2">&quot;What was their start date?&quot;</span><span class="p">,</span>
                <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=-</span><span class="mi">260</span><span class="p">),</span>
                <span class="n">min_value</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=-</span><span class="mi">2600</span><span class="p">),</span>
            <span class="p">)</span>

            <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;***Double check the date.*** It is most important that the year be correct. If using the calendar tool, the last date selected will be inserted into the blank.&quot;</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s2">&quot;Draft letter&quot;</span><span class="p">):</span>
                <span class="c1"># submit prompt</span>
                <span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">spinner</span><span class="p">(</span><span class="s2">&quot;Drafting. This may take a while...&quot;</span><span class="p">):</span>
                    <span class="k">with</span> <span class="n">get_openai_callback</span><span class="p">()</span> <span class="k">as</span> <span class="n">response_meta</span><span class="p">:</span>
                        <span class="n">submit_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                        <span class="n">workflow</span> <span class="o">=</span> <span class="n">RecommendationLetterDrafter</span><span class="p">(</span>
                            <span class="n">areas_of_excellence</span><span class="p">,</span> <span class="n">selected_date</span><span class="p">,</span> <span class="n">cv_document</span>
                        <span class="p">)</span>
                        <span class="n">generated_response</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>
                        <span class="n">response_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                        <span class="n">portfolio_docx_data</span> <span class="o">=</span> <span class="n">convert_markdown_docx</span><span class="p">(</span>
                            <span class="n">generated_response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">template_location</span>
                        <span class="p">)</span>

                <span class="k">if</span> <span class="n">portfolio_docx_data</span><span class="p">:</span>
                    <span class="n">st</span><span class="o">.</span><span class="n">balloons</span><span class="p">()</span>
                    <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Note that once you hit download, this form will reset.&quot;</span><span class="p">)</span>

                    <span class="n">st</span><span class="o">.</span><span class="n">download_button</span><span class="p">(</span>
                        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Download letter draft&quot;</span><span class="p">,</span>
                        <span class="n">data</span><span class="o">=</span><span class="n">portfolio_docx_data</span><span class="p">,</span>
                        <span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;DRAFT_recommendation_letter.docx&quot;</span><span class="p">,</span>
                        <span class="n">mime</span><span class="o">=</span><span class="s2">&quot;application/vnd.openxmlformats-officedocument.wordprocessingml.document&quot;</span><span class="p">,</span>  <span class="c1"># correct MIME type for docx</span>
                    <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Please upload a Word Document (.docx) CV to proceed.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../.." class="btn btn-neutral float-left" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../CV_Promoter/workflows/" class="btn btn-neutral float-right" title="workflows">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/UABPeriopAI/CV_Promoter" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../.." style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../CV_Promoter/workflows/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
